var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,r){return new(i||(i=Promise))(function(o,n){function s(t){try{h(r.next(t))}catch(e){n(e)}}function a(t){try{h(r["throw"](t))}catch(e){n(e)}}function h(t){t.done?o(t.value):new i(function(e){e(t.value)}).then(s,a)}h((r=r.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return r([t,e])}}function r(i){if(o)throw new TypeError("Generator is already executing.");for(;h;)try{if(o=1,n&&(s=n[2&i[0]?"return":i[0]?"throw":"next"])&&!(s=s.call(n,i[1])).done)return s;switch(n=0,s&&(i=[0,s.value]),i[0]){case 0:case 1:s=i;break;case 4:return h.label++,{value:i[1],done:!1};case 5:h.label++,n=i[1],i=[0];continue;case 7:i=h.ops.pop(),h.trys.pop();continue;default:if(s=h.trys,!(s=s.length>0&&s[s.length-1])&&(6===i[0]||2===i[0])){h=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){h.label=i[1];break}if(6===i[0]&&h.label<s[1]){h.label=s[1],s=i;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(i);break}s[2]&&h.ops.pop(),h.trys.pop();continue}i=e.call(t,h)}catch(r){i=[6,r],n=0}finally{o=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var o,n,s,a,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return a={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},BaseRenderer=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.COMPLETE,e.__skinComleteHandler,e),e}return __extends(e,t),e.prototype.__skinComleteHandler=function(t){this._skinComplete=!0,this.init()},e.prototype.init=function(){return this._destory?void this.dispose():(this._isFinish=!0,this.initView(),this.initEvent(),void this.initData())},e.prototype.initView=function(){},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.initData=function(){},Object.defineProperty(e.prototype,"isFinish",{get:function(){return this._isFinish},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._destory=!0,this.removeEventListener(egret.Event.COMPLETE,this.__skinComleteHandler,this),this.parent&&this.parent.removeChild(this)},e}(eui.ItemRenderer);__reflect(BaseRenderer.prototype,"BaseRenderer",["IDispose"]);var BaseUI=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.COMPLETE,e.__skinComleteHandler,e),e}return __extends(e,t),e.prototype.__skinComleteHandler=function(t){this._skinComplete=!0,this.init()},e.prototype.init=function(){return this._destory?void this.dispose():(this._isFinish=!0,this.initView(),this.initEvent(),void this.initData())},e.prototype.initView=function(){},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.initData=function(){},Object.defineProperty(e.prototype,"isFinish",{get:function(){return this._isFinish},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this._destory=!0,this.removeEventListener(egret.Event.COMPLETE,this.__skinComleteHandler,this),this.parent&&this.parent.removeChild(this),this.dispatchEventWith(MEvent.DISPOSE)},e}(eui.Component);__reflect(BaseUI.prototype,"BaseUI",["IDispose"]);var BaseAvatar=function(t){function e(e){var i=t.call(this)||this;return i._avo=e,i.range=20,i.init(),i.start(),i.touchChildren=!1,i.touchEnabled=!0,i}return __extends(e,t),e.prototype.init=function(){this._avo&&(this._pos=new egret.Point,this._body=new egret.Bitmap,this._speed=this._avo.speed||1,this._grade=this._avo.grade||1,this.initPos(),this.initFactory(),this.updateMode(),this.show())},e.prototype.initPos=function(){this.x=this._avo.x||0,this.y=this._avo.y||0},e.prototype.updateNextPoint=function(){},e.prototype.show=function(){App.layer.addChild(this,1)},e.prototype.initFactory=function(){},e.prototype.updateMode=function(){},e.prototype.update=function(t){},e.prototype.hit=function(t){},e.prototype.start=function(){this._stop=!1},e.prototype.stop=function(){this._stop=!0},Object.defineProperty(e.prototype,"isStop",{get:function(){return this._stop},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"range",{get:function(){return this._range},set:function(t){this._range=t},enumerable:!0,configurable:!0}),e.prototype.setSpeed=function(t){this._speed=(this._avo.speed||1)+5*t},e.prototype.setAngle=function(t){this._angle=t},e.prototype.resetSpeed=function(){this._speed=this._avo.speed||1},Object.defineProperty(e.prototype,"pos",{get:function(){return this._pos.x=this.x||0,this._pos.y=this.y||0,this._pos},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"masType",{get:function(){return 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return this._avo?this._avo.type:0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isDie",{get:function(){return this._isDie},enumerable:!0,configurable:!0}),e.prototype.die=function(){this._isDie=!0,GameConst.dispose(this)},e.prototype.dispose=function(){this._avo=null,GameConst.dispose(this._body),this._body=null,this.mc&&(this.mc.stop(),this.mc.parent&&this.mc.parent.removeChild(this.mc),this.mc=null),this.dataFactory=null,this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(BaseAvatar.prototype,"BaseAvatar",["IEnterFrame","IDispose"]);var Germ_1_Avatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("301_json"),e=RES.getRes("301_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="301_1";this._avo.supper&&(t+="_"+(this._avo.sgrade||1));var e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.initPos=function(){if(this.isRandom)this.x=this._avo.x||0,this.y=this._avo.y||0,this._angle=this._avo.angel||Math.floor(360*Math.random());else{var t=App.grid.getGridByType(1);t&&(this.x=t.x*App.grid.grid_w+20,this.y=t.y*App.grid.grid_h+20)}},e.prototype.updatePaths=function(){var t=App.grid.getGridByType(1);if(t){var e={};e.x=Math.floor(this.x/App.grid.grid_w),e.y=Math.floor(this.y/App.grid.grid_h),this._paths=App.grid.findPath(e,t,1)}},e.prototype.updateNextPoint=function(){!this._nextPoint&&(this._nextPoint={}),this._paths&&0!=this._paths.length||this.updatePaths();var t=this._paths.shift();if(t){this._nextPoint.x=t.x*App.grid.grid_w+20,this._nextPoint.y=t.y*App.grid.grid_h+20;var e=Math.atan2(this._nextPoint.y-this.y,this._nextPoint.x-this.x);this._angle=180*e/Math.PI}},e.prototype.update=function(t){!this._avo||this._isDie||this._stop||(this.isRandom?this.updateRandomPos():this.walkNexPoint())},e.prototype.walkNexPoint=function(){this._nextPoint||this.updateNextPoint();var t=this._speed;this.rotation=this._angle;var e,i;if(Math.sqrt(Math.pow(this.x-this._nextPoint.x,2)+Math.pow(this.y-this._nextPoint.y,2))<t)e=this._nextPoint.x,i=this._nextPoint.y,this.updateNextPoint();else{var r=this._angle*Math.PI/180;e=this.x+Math.cos(r)*t,i=this.y+Math.sin(r)*t}this.x=e,this.y=i},e.prototype.updateRandomPos=function(){var t=this._speed,e=this._angle;this.rotation=e;var i=e*Math.PI/180,r=Math.cos(i)*t,o=Math.sin(i)*t;this.checkRange(r,o)||(this.x+=r,this.y+=o)},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this.setAngle(n+Math.floor(360*Math.random())),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 301},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.mc&&(this.mc.stop(),this.mc.parent&&this.mc.parent.removeChild(this.mc),this.mc=null),t.prototype.dispose.call(this)},e}(BaseAvatar);__reflect(Germ_1_Avatar.prototype,"Germ_1_Avatar");var ThemeAdapter=function(){function t(){}return t.prototype.getTheme=function(t,e,i,r){function o(t){e.call(r,t)}function n(e){e.resItem.url==t&&(RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),i.call(r))}var s=this;if("undefined"!=typeof generateEUI)egret.callLater(function(){e.call(r,generateEUI)},this);else if("undefined"!=typeof generateEUI2)RES.getResByUrl("resource/gameEui.json",function(t,i){window.JSONParseClass.setData(t),egret.callLater(function(){e.call(r,generateEUI2)},s)},this,RES.ResourceItem.TYPE_JSON);else if("undefined"!=typeof generateJSON)if(t.indexOf(".exml")>-1){var a=t.split("/");a.pop();var h=a.join("/")+"_EUI.json";generateJSON.paths[t]?egret.callLater(function(){e.call(r,generateJSON.paths[t])},this):RES.getResByUrl(h,function(i){window.JSONParseClass.setData(i),egret.callLater(function(){e.call(r,generateJSON.paths[t])},s)},this,RES.ResourceItem.TYPE_JSON)}else egret.callLater(function(){e.call(r,generateJSON)},this);else RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,n,null),RES.getResByUrl(t,o,this,RES.ResourceItem.TYPE_TEXT)},t}();__reflect(ThemeAdapter.prototype,"ThemeAdapter",["eui.IThemeAdapter"]);var GameConst;!function(t){function e(e,i){e=e||1;var r=i?"_lock":"";return t.res_path+"level/level_"+e+r+".png"}function i(e){return t.res_path+"shop/shop_"+e+".png"}function r(e){return t.res_path+"teach/teach_"+e+".png"}function o(e){return t.res_path+"map/"+e+"/desc.json"}function n(e,i){return t.res_path+"map/"+e+"/plate/"+i+".png"}function s(e){return t.res_path+"map/"+e+"/germ_map.png"}function a(e){return t.res_path+"map/"+e+"/t_cell_map.png"}function h(e){return t.res_path+"map/"+e+"/grid.json"}function p(e){return t.res_path+"avatar/"+e}function l(t){t&&(egret.is(t,"IDispose")&&t.dispose(),t.parent&&t.parent.removeChild(t))}function c(t){switch(t){case 301:return 1;case 302:return.5;case 303:return 1.5;case 304:return 1;case 401:return 1;case 402:return 1;case 403:return 1;case 501:case 502:case 503:return 1}return 1}t.GAME_FRAME=60,t.res_path="resource/",t.MAX_LEVEL=7,t.getLevelBackPath=e,t.getGoodsBackPath=i,t.getTeachPath=r,t.getPlateDescPath=o,t.getPlateImgPath=n,t.getGermMapPath=s,t.getTCellMapPath=a,t.getMapGridPath=h,t.getAvatarModel=p,t.dispose=l,t.getGermSpeedByType=c}(GameConst||(GameConst={}));var MEvent=function(){function t(){}return t.DISPOSE="dispose",t.HEARTBEAT="heartbeat",t.ADD_GOLD="add_gold",t.RESTART="re_start",t.GAME_OVER="game_over",t.GERM_UPDATE="germ_update",t.GAME_ENTER_FRAME="game_enter_frame",t}();__reflect(MEvent.prototype,"MEvent");var ResConst=function(){function t(){}return t.group_preload="preload",t.group_login="login",t.json_shop="shop_json",t.json_level="level_json",t.json_toolbar="toolbar_json",t.json_pause="pause_json",t.json_hp="hpbar_json",t}();__reflect(ResConst.prototype,"ResConst");var ConfigManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(t){t||(console.error("找不到游戏配置信息!!!"),t={}),this.config_data=t},t.prototype.getOpenStarByLevel=function(t){return this.config_data.level?this.config_data.level[t-1]||0:0},t.prototype.getAllShopGoods=function(){var t=this.config_data.shop;return t||[]},t.prototype.getPriceByType=function(t){var e=this.config_data.price;return e||(e=this.config_data.price={}),e[t]||0},t}();__reflect(ConfigManager.prototype,"ConfigManager");var LayerManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(e){if(e){this._stage=e;var i=t.STAGE_WIDTH,r=t.STAGE_HEIGHT;this._senceLayer=new eui.UILayer,this._senceLayer.touchEnabled=!1,this._senceLayer.scrollEnabled=!0,this._senceLayer.width=i,this._senceLayer.height=r,this._senceLayer.verticalCenter=0,this._senceLayer.horizontalCenter=0,this._uiLayer=new eui.UILayer,this._uiLayer.touchEnabled=!1,this._uiLayer.scrollEnabled=!0,this._uiLayer.width=i,this._uiLayer.height=r,this._uiLayer.verticalCenter=0,this._uiLayer.horizontalCenter=0,this._topLayer=new eui.UILayer,this._topLayer.touchEnabled=!1,this._topLayer.scrollEnabled=!0,this._topLayer.width=i,this._topLayer.height=r,this._topLayer.verticalCenter=0,this._topLayer.horizontalCenter=0,this._stage.addChild(this._senceLayer),this._stage.addChild(this._uiLayer),this._stage.addChild(this._topLayer)}},t.prototype.addChild=function(t,e){if(t){var i=this.getLayerByType(e);i&&i.addChild(t)}},t.prototype.getLayerByType=function(t){switch(t){case 1:return this._senceLayer;case 3:return this._topLayer;case 2:return this._uiLayer}return null},t.prototype.clearAll=function(){this.clearLayer(1),this.clearLayer(2),this.clearLayer(3)},t.prototype.clearLayer=function(t){var e=this.getLayerByType(t);if(e)for(;e.numChildren>0;)GameConst.dispose(e.getChildAt(0))},t.STAGE_WIDTH=1920,t.STAGE_HEIGHT=1080,t}();__reflect(LayerManager.prototype,"LayerManager");var MessageManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(){this._isSetup||(this._isSetup=!0,this.initView())},t.prototype.initView=function(){this.contGroup=new eui.Group,this.contGroup.horizontalCenter=0,this.contGroup.verticalCenter=0,this.contGroup.width=400,this.contGroup.height=100;var t=new eui.Image;t.percentWidth=100,t.percentHeight=100,t.source="core_json.msg_back",t.scale9Grid=new egret.Rectangle(50,20,350,80),this.contGroup.addChild(t);var e=new eui.Rect(50,50,16777215);e.alpha=.8,e.left=e.top=e.bottom=10,e.right=20,this.contGroup.addChild(e),this.msgTxt=new eui.Label,this.msgTxt.textAlign="center",this.msgTxt.fontFamily="SimSun",this.msgTxt.textColor=16711680,this.msgTxt.size=30,this.msgTxt.height=30,this.msgTxt.horizontalCenter=0,this.msgTxt.verticalCenter=0,this.msgTxt.stroke=1,this.msgTxt.strokeColor=6842472,this.contGroup.addChild(this.msgTxt)},t.prototype.show=function(t){if(t){egret.Tween.removeTweens(this.contGroup),this.contGroup.verticalCenter=0,this.msgTxt.text=t,App.layer.addChild(this.contGroup,3);var e=this;egret.Tween.get(this.contGroup).to({verticalCenter:-100},600).wait(300).call(function(){e.contGroup.parent&&e.contGroup.parent.removeChild(e.contGroup)},this)}},t}();__reflect(MessageManager.prototype,"MessageManager");var PlayerManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(){this._dataKey="virus";var t=egret.localStorage.getItem(this._dataKey);if(t)try{this._playerInfo=JSON.parse(t)}catch(e){console.log("缓存数据错误!")}this._playerInfo||this.initPlayerData(),console.log("玩家数据：",this._playerInfo)},t.prototype.initPlayerData=function(){this._playerInfo={},this._playerInfo.levelData=[],this._playerInfo.prop=[101,301],this.savePlayerData()},t.prototype.getDataByLevel=function(t){var e=this._playerInfo.levelData;e||(e=this._playerInfo.levelData=[]);var i=e[t];return i||(i=e[t]={level:t,star:0}),i},t.prototype.haveGoods=function(t){var e=this._playerInfo.prop;return e.indexOf(t)>=0},Object.defineProperty(t.prototype,"totalStar",{get:function(){for(var t=0,e=this._playerInfo.levelData,i=e?e.length:0,r=0;i>r;r++)e[r]&&(t+=e[r].star||0);return t},enumerable:!0,configurable:!0}),t.prototype.savePlayerData=function(){if(this._playerInfo){var t="";try{t=JSON.stringify(this._playerInfo),egret.localStorage.setItem(this._dataKey,t),console.log("保存数据成功!",t)}catch(e){console.log("保存数据错误！")}}},t.prototype.clearPlayerData=function(){this.initPlayerData()},t.prototype.updateLevelStar=function(t,e){var i=this.getDataByLevel(t);i.star<e&&(i.star=e),this.savePlayerData()},t.prototype.addPorp=function(t){if(t){var e=this._playerInfo.prop;-1==e.indexOf(t)&&(e.push(t),this.savePlayerData(),SwitchHelp.openNewPropFrame(t))}},t}();__reflect(PlayerManager.prototype,"PlayerManager");var SceneManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(){this._plateUrls=[],this._mapUrls=[],this._plateImgs=[],this._mapData={}},t.prototype.enter=function(t){this._level!=t&&(this._level=t,App.loading.show(),this._plateUrls.length=0,this._mapUrls.length=0,this._plateImgs.length=0,this._mapData.level=this._level,this._mapData.germ=this._mapData.tcell=null,this._plateUrl=GameConst.getPlateDescPath(this._level),RES.getResByUrl(this._plateUrl,this.__plateDescHandler,this))},t.prototype.__plateDescHandler=function(t,e){if(this._plateUrl==e){if(this._mapData.desc=t,!t)return console.log("加载关卡数据错误!",e),void this.exitScene();t.plateTotal>0?(this._plateCount=t.plateTotal,this._complete=0,this._currIndex=1,this.loadPlate()):this.playPlate(1),this.loadGermMap(),this.loadTCellMap(),this.loadMapGrid();var i=this;RES.loadGroup("map").then(function(t){i.playPlate(8)},function(t){})}},t.prototype.loadPlate=function(){this._plateUrl=GameConst.getPlateImgPath(this._level,this._currIndex),this._plateUrls.push(this._plateUrl),RES.getResByUrl(this._plateUrl,this.__plateImgHandler,this)},t.prototype.__plateImgHandler=function(t,e){return this._plateUrl==e?(t&&this._plateImgs.push(t),this._currIndex++,this._currIndex>this._plateCount?void this.playPlate(1):void this.loadPlate()):void 0},t.prototype.loadGermMap=function(){this._germMapUrl=GameConst.getGermMapPath(this._level),this._mapUrls.push(this._germMapUrl),RES.getResByUrl(this._germMapUrl,this.__germMapHandler,this)},t.prototype.__germMapHandler=function(t,e){this._germMapUrl==e&&(this._mapData.germ=t,this.playPlate(2))},t.prototype.loadTCellMap=function(){this._tCellMapUrl=GameConst.getTCellMapPath(this._level),this._mapUrls.push(this._tCellMapUrl),RES.getResByUrl(this._tCellMapUrl,this.__tCellMapHandler,this)},t.prototype.__tCellMapHandler=function(t,e){this._tCellMapUrl==e&&(this._mapData.tcell=t,this.playPlate(4))},t.prototype.loadMapGrid=function(){this._mapgrideUrl=GameConst.getMapGridPath(this._level),this._mapUrls.push(this._mapgrideUrl),RES.getResByUrl(this._mapgrideUrl,this.__gridMapHandler,this)},t.prototype.__gridMapHandler=function(t,e){this._mapgrideUrl==e&&(this._mapData.grid=t,this.playPlate(16))},t.prototype.playPlate=function(t){if(this._complete=this._complete|t,!(this._complete<31))if(App.loading.hide(),App.layer.clearAll(),this._plateImgs.length>0){var e=new PlateFrame;e.addEventListener(egret.Event.CLOSE,this.__plateFrameCloseHandler,this),e.show(this._plateImgs)}else this.__plateFrameCloseHandler(null)},t.prototype.__plateFrameCloseHandler=function(t){for(;this._plateUrls.length>0;)RES.destroyRes(this._plateUrls.pop());this._scene=new LevelScene,this._scene.setup(this._mapData)},t.prototype.exitScene=function(){for(App.layer.clearAll(),App.game.exit();this._mapUrls.length>0;)RES.destroyRes(this._mapUrls.pop());this._mapUrls.length=0,this._scene.exit(),this._scene=null,RES.destroyRes("map"),SwitchHelp.openLevelFrame(this._level),this._level=0},Object.defineProperty(t.prototype,"level",{get:function(){return this._level||0},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"mapDesc",{get:function(){return this._mapData?this._mapData.desc:null},enumerable:!0,configurable:!0}),t}();__reflect(SceneManager.prototype,"SceneManager");var StageManager=function(){function t(){t._instance=this}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.setup=function(t){this._stage=t},Object.defineProperty(t.prototype,"stage",{get:function(){return this._stage},enumerable:!0,configurable:!0}),t}();__reflect(StageManager.prototype,"StageManager");var FristPageView=function(t){function e(){var e=t.call(this)||this;return e.min_num=22,e.max_num=554,e}return __extends(e,t),e.prototype.start=function(){this.width=1920,this.height=1080,this.list=[],this.curr_index=this.min_num,this.img=new egret.Bitmap,this.addChild(this.img),this.loadNext()},e.prototype.loadNext=function(){var t=this.curr_index+"_png";RES.getResAsync(t,this.__loadComplateHandler,this)},e.prototype.__loadComplateHandler=function(t,e){this.list.push(t),this.curr_index+=4,this.curr_index>this.max_num?this.play():this.loadNext()},e.prototype.play=function(){App.loading.hide(),App.layer.addChild(this,2),this.dispatchEventWith(egret.Event.COMPLETE),this.curr_index=0,this.startTime=egret.getTimer(),this.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.__enterFrameHandler=function(){var t=egret.getTimer();return this.curr_index=Math.floor((t-this.startTime)/100),this.curr_index>=this.list.length?(this.curr_index=0,this.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this),void this.dispose()):void(this.img.texture=this.list[this.curr_index])},e.prototype.dispose=function(){if(this.list)for(var t=void 0;this.list.length>0;)t=this.list.pop(),t.dispose();this.list=null,this.dispatchEventWith(MEvent.DISPOSE),this.parent&&this.parent.removeChild(this)},e}(eui.Group);__reflect(FristPageView.prototype,"FristPageView");var AssetAdapter=function(){function t(){}return t.prototype.getAsset=function(t,e,i){function r(r){e.call(i,r,t)}if(RES.hasRes(t)){var o=RES.getRes(t);o?r(o):RES.getResAsync(t,r,this)}else RES.getResByUrl(t,r,this,RES.ResourceItem.TYPE_IMAGE)},t}();__reflect(AssetAdapter.prototype,"AssetAdapter",["eui.IAssetAdapter"]);var Main=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.prototype.createChildren=function(){t.prototype.createChildren.call(this),egret.Capabilities.isMobile?GameConst.GAME_FRAME=30:GameConst.GAME_FRAME=60,this.stage.frameRate=GameConst.GAME_FRAME,egret.lifecycle.addLifecycleListener(function(t){}),egret.lifecycle.onResume=function(){};var e=new AssetAdapter;egret.registerImplementation("eui.IAssetAdapter",e),egret.registerImplementation("eui.IThemeAdapter",new ThemeAdapter),App={},this.initMgr(),this.runGame()["catch"](function(t){console.log(t)})},e.prototype.runGame=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return[4,this.loadResource()];case 1:return t.sent(),this.createGameScene(),[2]}})})},e.prototype.loadResource=function(){return __awaiter(this,void 0,void 0,function(){var t,e;return __generator(this,function(i){switch(i.label){case 0:return i.trys.push([0,5,,6]),[4,RES.loadConfig("default.res.json",GameConst.res_path)];case 1:return i.sent(),[4,this.loadTheme()];case 2:return i.sent(),t=App.loading,t.show(),[4,RES.loadGroup(ResConst.group_preload,0,t)];case 3:return i.sent(),t.init(),[4,RES.loadGroup(ResConst.group_login,0,t)];case 4:return i.sent(),[3,6];case 5:return e=i.sent(),console.error(e),[3,6];case 6:return[2]}})})},e.prototype.loadTheme=function(){var t=this;return new Promise(function(e,i){var r=new eui.Theme("resource/default.thm.json",t.stage);r.addEventListener(eui.UIEvent.COMPLETE,function(){e()},t)})},e.prototype.initMgr=function(){App.layer=LayerManager.instance,App.stage=StageManager.instance,App.player=PlayerManager.instance,App.config=ConfigManager.instance,App.msg=MessageManager.instance,App.scene=SceneManager.instance,App.game=GameManager.instance,App.grid=GridManager.instance,App.layer.setup(this.stage),App.stage.setup(this.stage),App.player.setup(),App.loading=LoadingUI.instance},e.prototype.createGameScene=function(){App.loading.hide(),App.config.setup(RES.getRes("config_data_json")),App.msg.setup(),App.scene.setup(),SwitchHelp.openLoginFrame(),this.parent&&this.parent.removeChild(this)},e}(eui.UILayer);__reflect(Main.prototype,"Main");var LevelFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.verticalCenter=0,this.horizontalCenter=0,this.urlList=[]},e.prototype.initEvent=function(){this.leftBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__preLevelHandler,this),this.rightBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextLevelHandler,this),this.shopBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__openShopHandler,this),this.backImg.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__clickHandler,this)},e.prototype.removeEvent=function(){this.leftBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__preLevelHandler,this),this.rightBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextLevelHandler,this),this.shopBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__openShopHandler,this),this.backImg.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__clickHandler,this)},e.prototype.initData=function(){this.currLevel=this.currLevel||1,this.updateView()},e.prototype.__preLevelHandler=function(t){this.currLevel--,this.updateView()},e.prototype.__nextLevelHandler=function(t){this.currLevel++,this.updateView()},e.prototype.__clickHandler=function(t){return this.is_lock?void App.msg.show("关卡未解锁!!!"):void App.scene.enter(this.currLevel)},e.prototype.__openShopHandler=function(t){SwitchHelp.openShopFrame(),GameConst.dispose(this)},e.prototype.updateBtnState=function(){this.leftBtn.visible=this.currLevel>1,this.rightBtn.visible=this.currLevel<GameConst.MAX_LEVEL},e.prototype.updateView=function(){if(this._isFinish&&this.currLevel){this.levelData=App.player.getDataByLevel(this.currLevel),this.updateBtnState(),this.titleImg.source="level_json.level_t_"+this.currLevel;var t=App.config.getOpenStarByLevel(this.currLevel),e=App.player.totalStar;this.is_lock=t>e,this.updateStar(),this.currKey=GameConst.getLevelBackPath(this.currLevel,this.is_lock),-1==this.urlList.indexOf(this.currKey)&&this.urlList.push(this.currKey),RES.getResByUrl(this.currKey,this.__backCompleteHandler,this)}},e.prototype.__backCompleteHandler=function(t,e){t&&this.currKey==e&&(this.backImg.texture=t)},e.prototype.updateStar=function(){var t=this.levelData.star;this.starGroup.visible=!this.is_lock;for(var e,i=1;3>=i;i++)e=this["star_"+i],t>=i?e.source="level_json.level_star_got":e.source="level_json.level_star_ungot"},e.prototype.show=function(t){this.currLevel=t,this.updateView(),App.layer.addChild(this,2)},e.prototype.dispose=function(){if(this.removeEvent(),GameConst.dispose(this.backImg),this.backImg=null,GameConst.dispose(this.lockImg),this.lockImg=null,GameConst.dispose(this.titleImg),this.titleImg=null,GameConst.dispose(this.rightBtn),this.rightBtn=null,GameConst.dispose(this.leftBtn),this.leftBtn=null,GameConst.dispose(this.star_1),this.star_1=null,GameConst.dispose(this.star_2),this.star_2=null,GameConst.dispose(this.star_3),this.star_3=null,GameConst.dispose(this.starGroup),this.starGroup=null,this.levelData=null,this.urlList)for(;this.urlList.length>0;)RES.destroyRes(this.urlList.pop());this.urlList=null,RES.destroyRes(ResConst.json_level),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(LevelFrame.prototype,"LevelFrame");var LoginFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.logoImg.y=-256,this.soundBtn.y=-70,this.startBtn.y=1920},e.prototype.initEvent=function(){this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__startBtnHandler,this)},e.prototype.removeEvent=function(){this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__startBtnHandler,this)},e.prototype.initData=function(){egret.Tween.get(this).wait(200).call(this.__startPlay,this)},e.prototype.__startPlay=function(){egret.Tween.get(this.logoImg).to({y:169},500,egret.Ease.sineInOut),egret.Tween.get(this.soundBtn).to({y:138},500,egret.Ease.sineInOut),egret.Tween.get(this.startBtn).wait(400).to({y:848},500,egret.Ease.sineInOut)},e.prototype.__startBtnHandler=function(t){App.loading.show();var e=new FristPageView;e.verticalCenter=0,e.horizontalCenter=0,e.addEventListener(egret.Event.COMPLETE,this.dispose,this),e.addEventListener(MEvent.DISPOSE,this.__pageCloseHandler,this),e.start()},e.prototype.__pageCloseHandler=function(t){SwitchHelp.openLevelFrame()},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),GameConst.dispose(this.backImg),this.backImg=null,GameConst.dispose(this.soundBtn),this.soundBtn=null,GameConst.dispose(this.startBtn),this.startBtn=null,RES.destroyRes(ResConst.group_login),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(LoginFrame.prototype,"LoginFrame");var LevelScene=function(t){function e(){var e=t.call(this)||this;return e.width=1920,e.height=1080,e.verticalCenter=0,e.horizontalCenter=0,e.touchEnabled=!1,e._initPoint={},e}return __extends(e,t),e.prototype.setup=function(t){this.show(),this._mapData=t,App.game.setup(this._mapData),this.initMap(t),this.initView(),this.initEvent(),this.showTeach()},e.prototype.initMap=function(t){this._germImg=new egret.Bitmap,this._germImg.texture=t.germ,this.addChild(this._germImg),this._tcellImg=new egret.Bitmap,this._tcellImg.texture=t.tcell,this.addChild(this._tcellImg),App.grid.setup(t.grid)},e.prototype.initView=function(){!this._currPos&&(this._currPos=new egret.Point);var t=this._mapData.desc;new HpBar(t).show(),(new ToolBar).show(),(new PriceBar).show(),(new TimeBar).show(),this._fortMc=new FortAvatar,this._fortMc.show(t.fortpos)},e.prototype.initEvent=function(){App.stage.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.__touchBeginHandler,this)},e.prototype.removeEvent=function(){App.stage.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.__touchBeginHandler,this),this.removeTouchEvent()},e.prototype.addTouchEvent=function(){App.stage.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.__touchMoveHandler,this),App.stage.stage.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.__touchCancelHandler,this),App.stage.stage.addEventListener(egret.TouchEvent.TOUCH_END,this.__touchCancelHandler,this)},e.prototype.removeTouchEvent=function(){App.stage.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.__touchMoveHandler,this),App.stage.stage.removeEventListener(egret.TouchEvent.TOUCH_CANCEL,this.__touchCancelHandler,this),App.stage.stage.removeEventListener(egret.TouchEvent.TOUCH_END,this.__touchCancelHandler,this)},e.prototype.__touchBeginHandler=function(t){var e=t.target;if(e)if(egret.is(e,"BaseAvatar"))this._needBuy=!1,this._target=e,this._target.stop(),this._initPoint.x=this._target.x,this._initPoint.y=this._target.y,this.addTouchEvent();else if(egret.is(e,"eui.ToggleButton")){var i=parseInt(e.label);if(!App.player.haveGoods(i))return void App.msg.show("未解锁该道具!");this._needBuy=!0,this._target=App.game.create(i),this.globalToLocal(t.stageX,t.stageY,this._currPos),this._target.x=this._currPos.x,this._target.y=this._currPos.y,this.addTouchEvent()}},e.prototype.__touchMoveHandler=function(t){var e=t.target;!this._fortDown&&this._target&&egret.is(e,"FortAvatar")?(this._fortDown=!0,this._fortMc.addChildAt(this._target,0),this._target.x=50,this._target.y=0,this._target.rotation=0):this._fortDown&&(this.globalToLocal(t.stageX,t.stageY,this._currPos),this._fortMc.touchPos(this._currPos.x,this._currPos.y)),this._target&&!this._fortDown&&(this.globalToLocal(t.stageX,t.stageY,this._currPos),this._target.x=this._currPos.x,this._target.y=this._currPos.y)},e.prototype.__touchCancelHandler=function(t){if(this._target)if(this._needBuy)if(this._needBuy=!1,this._fortDown){var e=App.config.getPriceByType(this._target.type);e>App.game.currGold?(this._target.dispose(),this._target=null):(App.game.buyProp(e),101==this._target.type?(App.game.addWater(),this._target.dispose(),this._target=null):(this._target.isRandom=!0,this._fortMc.localToGlobal(this._target.x,this._target.y,this._currPos),this._target.x=this._currPos.x,this._target.y=this._currPos.y,this._target.setAngle(this._fortMc.rotation),this._target.setSpeed(this._fortMc.currRate),this._target.show(),this._target.start(),App.game.addAvatar(this._target),App.game.dispatchEventWith(MEvent.GERM_UPDATE)))
}else this._target.dispose(),this._target=null;else this._target&&(this._fortDown?(this._target.isRandom=!0,this._fortMc.localToGlobal(this._target.x,this._target.y,this._currPos),this._target.x=this._currPos.x,this._target.y=this._currPos.y,this._target.setAngle(this._fortMc.rotation),this._target.setSpeed(this._fortMc.currRate)):(this._target.x=this._initPoint.x,this._target.y=this._initPoint.y),this._target.show(),this._target.start());this._fortMc.setRate(1),this._target=null,this._fortDown=!1,this.removeTouchEvent()},e.prototype.show=function(){App.layer.addChild(this,1)},e.prototype.showTeach=function(){var t=App.player.getDataByLevel(this._mapData.level).star,e=this._mapData.desc.teach;if(e&&!t){var i=new TeachFrame;i.addEventListener(MEvent.DISPOSE,this.__teachFrameCloseHandler,this),i.show()}else this.__teachFrameCloseHandler(null)},e.prototype.__teachFrameCloseHandler=function(t){if(t){var e=t.target;e&&e.removeEventListener(MEvent.DISPOSE,this.__teachFrameCloseHandler,this)}setTimeout(this.startGame.bind(this),50)},e.prototype.startGame=function(){App.game.start()},e.prototype.exit=function(){this.removeEvent()},e}(eui.UILayer);__reflect(LevelScene.prototype,"LevelScene");var MapUtils=function(){function t(){}return t.checkHits=function(e,i){var r=e?e.length:0,o=i?i.length:0;if(r&&o){var n,s,a,h,p=e==i;for(n=0;r>n;n++)for(a=e[n],s=p?n+1:0;o>s;s++)h=i[s],a!=h&&t.isHit(a,h)&&a.hit(h)}},t.isHit=function(t,e){if(!t||!e)return!1;if(t.isDie||e.isDie)return!1;if(t.isStop||e.isStop)return!1;var i=t.pos,r=e.pos,o=egret.Point.distance(i,r);return o<t.range+e.range?!0:!1},t}();__reflect(MapUtils.prototype,"MapUtils");var AntiAvatar_1=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("401_json"),e=RES.getRes("401_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="401",e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.update=function(t){if(this._avo&&!this._isDie&&!this._stop){var e=this._speed,i=this._angle;this.rotation=i;var r=i*Math.PI/180,o=Math.cos(r)*e,n=Math.sin(r)*e;this.checkRange(o,n)||(this.x+=o,this.y+=n)}},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this._angle=n+Math.floor(360*Math.random()),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 401},enumerable:!0,configurable:!0}),e.prototype.hit=function(t){if(t){var e=t.masType;2==e||3==e&&(t.die(),this.die(),BoomEffect.getBoom(this.x,this.y))}},e}(BaseAvatar);__reflect(AntiAvatar_1.prototype,"AntiAvatar_1");var AntiAvatar_2=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("401_json"),e=RES.getRes("401_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="402",e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.update=function(t){if(this._avo&&!this._isDie&&!this._stop){var e=this._speed,i=this._angle;this.rotation=i;var r=i*Math.PI/180,o=Math.cos(r)*e,n=Math.sin(r)*e;this.checkRange(o,n)||(this.x+=o,this.y+=n)}},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this._angle=n+Math.floor(360*Math.random()),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 401},enumerable:!0,configurable:!0}),e.prototype.hit=function(t){if(t){var e=t.masType;2==e||3==e&&(t.die(),this.die(),BoomEffect.getBoom(this.x,this.y))}},e}(BaseAvatar);__reflect(AntiAvatar_2.prototype,"AntiAvatar_2");var AntiAvatar_3=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("401_json"),e=RES.getRes("401_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="403",e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.update=function(t){if(this._avo&&!this._isDie&&!this._stop){var e=this._speed,i=this._angle;this.rotation=i;var r=i*Math.PI/180,o=Math.cos(r)*e,n=Math.sin(r)*e;this.checkRange(o,n)||(this.x+=o,this.y+=n)}},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this._angle=n+Math.floor(360*Math.random()),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 4},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 401},enumerable:!0,configurable:!0}),e.prototype.hit=function(t){if(t){var e=t.masType;2==e||3==e&&(t.die(),this.die(),BoomEffect.getBoom(this.x,this.y))}},e}(BaseAvatar);__reflect(AntiAvatar_3.prototype,"AntiAvatar_3");var DebugPlatform=function(){function t(){}return t.prototype.getUserInfo=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2,{nickName:"username"}]})})},t.prototype.login=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return[2]})})},t}();__reflect(DebugPlatform.prototype,"DebugPlatform",["Platform"]),window.platform||(window.platform=new DebugPlatform);var BoomEffect=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(){var t=RES.getRes("boom_json"),e=RES.getRes("boom_png"),i=new egret.MovieClipDataFactory(t,e).generateMovieClipData("boom");i&&(this.mc=new egret.MovieClip(i),this.mc.addEventListener(egret.Event.COMPLETE,this.__playCompleteHandler,this),this.mc.play(1),this.addChild(this.mc))},e.prototype.__playCompleteHandler=function(t){GameConst.dispose(this)},e.prototype.dispose=function(){this.mc&&(this.mc.stop(),this.mc=null),this.parent&&this.parent.removeChild(this)},e.getBoom=function(t,i){var r=new e;r.x=t,r.y=i,r.show(),App.layer.addChild(r,1)},e}(egret.DisplayObjectContainer);__reflect(BoomEffect.prototype,"BoomEffect",["IDispose"]);var FortAvatar=function(t){function e(){var e=t.call(this)||this;return e.init(),e.initBody(),e}return __extends(e,t),e.prototype.init=function(){this.touchChildren=!1,this.touchEnabled=!0,this._currRate=1,this.maxRate=5,this.currPos=new egret.Point,this.targerPos=new egret.Point},e.prototype.initBody=function(){var t=RES.getRes("fort_json"),e=RES.getRes("fort_png"),i=new egret.MovieClipDataFactory(t,e).generateMovieClipData("fort");this.body=new egret.MovieClip(i),this.body.gotoAndStop(this._currRate),this.addChild(this.body)},e.prototype.touchPos=function(t,e){var i=Math.atan2(e-this.y,t-this.x),r=180*i/Math.PI;r=(360+r)%360,this.rotation=r,this.checkRate(t,e)},e.prototype.checkRate=function(t,e){this.currPos.x=this.x,this.currPos.y=this.y,this.targerPos.x=t,this.targerPos.y=e;var i=egret.Point.distance(this.currPos,this.targerPos);i>=100?this.setRate(1):i>=80?this.setRate(2):i>=60?this.setRate(3):i>=40?this.setRate(4):i>=20&&this.setRate(5)},e.prototype.show=function(t){if(t){this.x=t.x,this.y=t.y;var e=t.r;e&&e.length>1&&(this.minRange=e[0]||0,this.maxRange=e[1]||0,this.rotation=this.minRange+Math.floor(Math.random()*(this.maxRange-this.minRange)))}App.layer.addChild(this,2)},Object.defineProperty(e.prototype,"currRate",{get:function(){return this._currRate},enumerable:!0,configurable:!0}),e.prototype.setRate=function(t){(!t||1>t)&&(t=1),t>this.maxRate&&(t=this.maxRate),this._currRate=t,this.body&&this.body.gotoAndStop(this._currRate)},e.prototype.dispose=function(){this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(FortAvatar.prototype,"FortAvatar",["IDispose"]);var LoadingUI=function(t){function e(){var i=t.call(this)||this;return e._instance=i,i.createView(),i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance||new e},enumerable:!0,configurable:!0}),e.prototype.createView=function(){this.width=1920,this.height=1080,this.horizontalCenter=0,this.verticalCenter=0,this.backShape=new egret.Shape,this.backShape.graphics.beginFill(16777215,.6),this.backShape.graphics.drawRect(0,0,this.width,this.height),this.backShape.graphics.endFill(),this.addChild(this.backShape),this.msgTxt=new eui.Label,this.msgTxt.textColor=16711680,this.msgTxt.stroke=1,this.msgTxt.strokeColor=16777215,this.msgTxt.size=30,this.msgTxt.width=480,this.msgTxt.height=100,this.msgTxt.textAlign="center",this.msgTxt.horizontalCenter=0,this.msgTxt.verticalCenter=100,this.addChild(this.msgTxt)},e.prototype.onProgress=function(t,e){this.msgTxt.text="正在加载中..."+t+"/"+e},e.prototype.show=function(){this.msgTxt.text="正在加载中...",this.currIndex=1,this.step=0,LayerManager.instance.addChild(this,2),App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.hide=function(){App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this),this.parent&&this.parent.removeChild(this)},e.prototype.__enterFrameHandler=function(){this.waitImg&&(this.step++,this.step%3==0&&(this.waitImg.rotation-=20))},e.prototype.init=function(){this.waitImg=new eui.Image,this.waitImg.anchorOffsetX=36,this.waitImg.anchorOffsetY=36,this.waitImg.texture=RES.getRes("core_json.loading_1"),this.waitImg.horizontalCenter=0,this.waitImg.verticalCenter=0,this.addChild(this.waitImg)},e}(eui.Group);__reflect(LoadingUI.prototype,"LoadingUI",["RES.PromiseTaskReporter"]);var Germ_2_Avatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("g_302_json"),e=RES.getRes("g_302_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="302_"+(this._avo.grade||1);this._avo.supper&&(t+="_"+(this._avo.sgrade||1));var e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.initPos=function(){if(this.isRandom)this.x=this._avo.x||0,this.y=this._avo.y||0,this._angle=this._avo.angel||Math.floor(360*Math.random());else{var t=App.grid.getGridByType(1);t&&(this.x=t.x*App.grid.grid_w+20,this.y=t.y*App.grid.grid_h+20)}},e.prototype.updatePaths=function(){var t=App.grid.getGridByType(1);if(t){var e={};e.x=Math.floor(this.x/App.grid.grid_w),e.y=Math.floor(this.y/App.grid.grid_h),this._paths=App.grid.findPath(e,t,1)}},e.prototype.updateNextPoint=function(){!this._nextPoint&&(this._nextPoint={}),this._paths&&0!=this._paths.length||this.updatePaths();var t=this._paths.shift();if(t){this._nextPoint.x=t.x*App.grid.grid_w+20,this._nextPoint.y=t.y*App.grid.grid_h+20;var e=Math.atan2(this._nextPoint.y-this.y,this._nextPoint.x-this.x);this._angle=180*e/Math.PI}},e.prototype.update=function(t){!this._avo||this._isDie||this._stop||(this.isRandom?this.updateRandomPos():this.walkNexPoint())},e.prototype.walkNexPoint=function(){this._nextPoint||this.updateNextPoint();var t=this._speed;this.rotation=this._angle;var e,i;if(Math.sqrt(Math.pow(this.x-this._nextPoint.x,2)+Math.pow(this.y-this._nextPoint.y,2))<t)e=this._nextPoint.x,i=this._nextPoint.y,this.updateNextPoint();else{var r=this._angle*Math.PI/180;e=this.x+Math.cos(r)*t,i=this.y+Math.sin(r)*t}this.x=e,this.y=i},e.prototype.updateRandomPos=function(){var t=this._speed,e=this._angle;this.rotation=e;var i=e*Math.PI/180,r=Math.cos(i)*t,o=Math.sin(i)*t;this.checkRange(r,o)||(this.x+=r,this.y+=o)},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this.setAngle(n+Math.floor(360*Math.random())),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 302},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.mc&&(this.mc.stop(),this.mc.parent&&this.mc.parent.removeChild(this.mc),this.mc=null),t.prototype.dispose.call(this)},e}(BaseAvatar);__reflect(Germ_2_Avatar.prototype,"Germ_2_Avatar");var Germ_3_Avatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("303_json"),e=RES.getRes("303_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="303_"+(this._avo.grade||1);this._avo.supper&&(t+="_"+(this._avo.sgrade||1));var e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.initPos=function(){if(this.isRandom)this.x=this._avo.x||0,this.y=this._avo.y||0,this._angle=this._avo.angel||Math.floor(360*Math.random());else{var t=App.grid.getGridByType(1);t&&(this.x=t.x*App.grid.grid_w+20,this.y=t.y*App.grid.grid_h+20)}},e.prototype.updatePaths=function(){var t=App.grid.getGridByType(1);if(t){var e={};e.x=Math.floor(this.x/App.grid.grid_w),e.y=Math.floor(this.y/App.grid.grid_h),this._paths=App.grid.findPath(e,t,1)}},e.prototype.updateNextPoint=function(){!this._nextPoint&&(this._nextPoint={}),this._paths&&0!=this._paths.length||this.updatePaths();var t=this._paths.shift();if(t){this._nextPoint.x=t.x*App.grid.grid_w+20,this._nextPoint.y=t.y*App.grid.grid_h+20;var e=Math.atan2(this._nextPoint.y-this.y,this._nextPoint.x-this.x);this._angle=180*e/Math.PI}},e.prototype.update=function(t){!this._avo||this._isDie||this._stop||(this.isRandom?this.updateRandomPos():this.walkNexPoint())},e.prototype.walkNexPoint=function(){this._nextPoint||this.updateNextPoint();var t=this._speed;this.rotation=this._angle;var e,i;if(Math.sqrt(Math.pow(this.x-this._nextPoint.x,2)+Math.pow(this.y-this._nextPoint.y,2))<t)e=this._nextPoint.x,i=this._nextPoint.y,this.updateNextPoint();else{var r=this._angle*Math.PI/180;e=this.x+Math.cos(r)*t,i=this.y+Math.sin(r)*t}this.x=e,this.y=i},e.prototype.updateRandomPos=function(){var t=this._speed,e=this._angle;this.rotation=e;var i=e*Math.PI/180,r=Math.cos(i)*t,o=Math.sin(i)*t;this.checkRange(r,o)||(this.x+=r,this.y+=o)},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this.setAngle(n+Math.floor(360*Math.random())),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 303},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){this.mc&&(this.mc.stop(),this.mc.parent&&this.mc.parent.removeChild(this.mc),this.mc=null),t.prototype.dispose.call(this)},e}(BaseAvatar);__reflect(Germ_3_Avatar.prototype,"Germ_3_Avatar");var Germ_4_Avatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initFactory=function(){var t=RES.getRes("304_json"),e=RES.getRes("304_png");this.dataFactory=new egret.MovieClipDataFactory(t,e),this.mc=new egret.MovieClip,this.mc.stop()},e.prototype.updateMode=function(){if(this.dataFactory){var t="304_1";this._avo.supper&&(t+="_"+(this._avo.sgrade||1));var e=this.dataFactory.generateMovieClipData(t);e&&(this.mc.movieClipData=e,this.mc.play(-1),this.addChild(this.mc))}},e.prototype.initPos=function(){if(this.isRandom)this.x=this._avo.x||0,this.y=this._avo.y||0,this._angle=this._avo.angel||Math.floor(360*Math.random());else{var t=App.grid.getGridByType(1);t&&(this.x=t.x*App.grid.grid_w+20,this.y=t.y*App.grid.grid_h+20)}},e.prototype.updatePaths=function(){var t=App.grid.getGridByType(1);if(t){var e={};e.x=Math.floor(this.x/App.grid.grid_w),e.y=Math.floor(this.y/App.grid.grid_h),this._paths=App.grid.findPath(e,t,1)}},e.prototype.updateNextPoint=function(){!this._nextPoint&&(this._nextPoint={}),this._paths&&0!=this._paths.length||this.updatePaths();var t=this._paths.shift();if(t){this._nextPoint.x=t.x*App.grid.grid_w+20,this._nextPoint.y=t.y*App.grid.grid_h+20;var e=Math.atan2(this._nextPoint.y-this.y,this._nextPoint.x-this.x);this._angle=180*e/Math.PI}},e.prototype.update=function(t){!this._avo||this._isDie||this._stop||(this.isRandom?this.updateRandomPos():this.walkNexPoint())},e.prototype.walkNexPoint=function(){this._nextPoint||this.updateNextPoint();var t=this._speed;this.rotation=this._angle;var e,i;if(Math.sqrt(Math.pow(this.x-this._nextPoint.x,2)+Math.pow(this.y-this._nextPoint.y,2))<t)e=this._nextPoint.x,i=this._nextPoint.y,this.updateNextPoint();else{var r=this._angle*Math.PI/180;e=this.x+Math.cos(r)*t,i=this.y+Math.sin(r)*t}this.x=e,this.y=i},e.prototype.updateRandomPos=function(){var t=this._speed,e=this._angle;this.rotation=e;var i=e*Math.PI/180,r=Math.cos(i)*t,o=Math.sin(i)*t;this.checkRange(r,o)||(this.x+=r,this.y+=o)},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this.setAngle(n+Math.floor(360*Math.random())),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 3},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 304},enumerable:!0,configurable:!0}),e.prototype.dispose=function(){t.prototype.dispose.call(this)},e}(BaseAvatar);__reflect(Germ_4_Avatar.prototype,"Germ_4_Avatar");var TCellAvatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.initPos=function(){if(this.isRandom)this.x=this._avo.x||0,this.y=this._avo.y||0,this._angle=this._avo.angel||Math.floor(360*Math.random());else{var t=App.grid.getGridByType(2);t&&(this.x=t.x*App.grid.grid_w+20,this.y=t.y*App.grid.grid_h+20)}},e.prototype.updatePaths=function(){var t=App.grid.getGridByType(2);if(t){var e={};e.x=Math.floor(this.x/App.grid.grid_w),e.y=Math.floor(this.y/App.grid.grid_h),this._paths=App.grid.findPath(e,t,2)}},e.prototype.updateNextPoint=function(){!this._nextPoint&&(this._nextPoint={}),this._paths&&0!=this._paths.length||this.updatePaths();var t=this._paths.shift();if(t){this._nextPoint.x=t.x*App.grid.grid_w+20,this._nextPoint.y=t.y*App.grid.grid_h+20;var e=Math.atan2(this._nextPoint.y-this.y,this._nextPoint.x-this.x);this._angle=180*e/Math.PI}},e.prototype.updateMode=function(){var t=Math.floor(4*Math.random())+1;this._body.texture=RES.getRes("cell_"+t+"_png"),this._body.x=-Math.floor(this._body.texture.textureWidth/2),this._body.y=-Math.floor(this._body.texture.textureHeight/2),this.range=Math.floor(this._body.texture.textureWidth/2),this.addChild(this._body)},e.prototype.update=function(t){!this._avo||this._isDie||this._stop||(this.isRandom?this.updateRandomPos():this.walkNexPoint())},e.prototype.walkNexPoint=function(){this._nextPoint||this.updateNextPoint();var t=this._speed;this.rotation=this._angle;var e,i;if(Math.sqrt(Math.pow(this.x-this._nextPoint.x,2)+Math.pow(this.y-this._nextPoint.y,2))<t)e=this._nextPoint.x,i=this._nextPoint.y,this.updateNextPoint();else{var r=this._angle*Math.PI/180;e=this.x+Math.cos(r)*t,i=this.y+Math.sin(r)*t}this.x=e,this.y=i},e.prototype.updateRandomPos=function(){var t=this._speed,e=this._angle;this.rotation=e;var i=e*Math.PI/180,r=Math.cos(i)*t,o=Math.sin(i)*t;this.checkRange(r,o)||(this.x+=r,this.y+=o)},e.prototype.checkRange=function(t,e){var i=!1,r=this.x+t,o=this.y+e;if((0>=r||r>=LayerManager.STAGE_WIDTH)&&(i=!0),(0>=o||o>=LayerManager.STAGE_HEIGHT)&&(i=!0),i){var n=this.rotation;this._angle=n+Math.floor(360*Math.random()),this.resetSpeed()}return i},Object.defineProperty(e.prototype,"masType",{get:function(){return 2},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"type",{get:function(){return 201},enumerable:!0,configurable:!0}),e.prototype.hit=function(t){if(t){var e=t.masType;2==e||3==e&&(t.die(),this.die(),BoomEffect.getBoom(this.x,this.y))}},e}(BaseAvatar);__reflect(TCellAvatar.prototype,"TCellAvatar");var WaterAvatar=function(t){function e(e){return t.call(this,e)||this}return __extends(e,t),e.prototype.updateMode=function(){this._body.texture=RES.getRes("water_png"),this._body.x=-Math.floor(this._body.texture.textureWidth/2),this._body.y=-Math.floor(this._body.texture.textureHeight/2),this.addChild(this._body)},e}(BaseAvatar);__reflect(WaterAvatar.prototype,"WaterAvatar");var WaterEffect=function(t){function e(){var e=t.call(this)||this;return e.initView(),e.initEvent(),e}return __extends(e,t),e.prototype.initView=function(){this._img=new egret.Bitmap,this.addChild(this._img),this._count=0,this._startTime=egret.getTimer(),App.layer.addChild(this,3)},e.prototype.initEvent=function(){App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.removeEvent=function(){App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.__enterFrameHandler=function(t){var e=egret.getTimer(),i=Math.floor((e-this._startTime)/100)%6+1;if(this._currFrame!=i){if(this._count>0)return void this.dispose();this._currFrame=i,this._img.texture=RES.getRes("water_"+i+"_png"),6==this._currFrame&&this._count++}},e.prototype.dispose=function(){this.removeEvent(),this.dispatchEventWith(egret.Event.COMPLETE),this.parent&&this.parent.removeChild(this)},e}(egret.DisplayObjectContainer);__reflect(WaterEffect.prototype,"WaterEffect",["IDispose"]);var AvatarFactory=function(){function t(){this._dicts={},this._dicts[1]=LevelFactory_1,this._dicts[2]=LevelFactory_2,this._dicts[3]=LevelFactory_3,this._dicts[4]=LevelFactory_4,this._dicts[5]=LevelFactory_5,this._dicts[6]=LevelFactory_6,this._dicts[7]=LevelFactory_7}return t.prototype.init=function(t){this._level=t;var e=this._dicts[t];return e?void(this._currFactory=new e):void console.log("未找到细菌工厂!!!")},t.prototype.getGrem=function(t){return this._currFactory?this._currFactory.getGrem(t):null},t.prototype.getCell=function(t){return this._currFactory?this._currFactory.getCell(t):null},t.prototype.getGramByTime=function(t){return this._currFactory?this._currFactory.getGramByTime(t):null},t.prototype.getCellByTime=function(t){return this._currFactory?this._currFactory.getCellByTime(t):null},t.prototype.exit=function(){this._currFactory=null},t}();__reflect(AvatarFactory.prototype,"AvatarFactory");var GameManager=function(t){function e(){var i=t.call(this)||this;return i._tcells=[],i._germs=[],i._sgerms=[],i._antis=[],e._instance=i,egret.lifecycle.onPause=function(){i.pause()},i}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return this._instance||new e},enumerable:!0,configurable:!0}),e.prototype.setup=function(t){return this._mapData=t,this._level=t.level,this._mapDesc=this._mapData.desc,this._mapDesc?(this._factory||(this._factory=new AvatarFactory),this._setuped=!0,void this.init()):void console.log("找不到关卡地图描述数据!关卡:",this._level)},e.prototype.init=function(){this.destoryAvatar(),this._gameFrame=0,this._totalTime=this._mapDesc.time||60,this._maxGold=this._mapDesc.maxGold||30,this._currGold=0,this._currTime=0,this._factory.init(this._level)},e.prototype.start=function(){this.initGerm(),this.resume()},e.prototype.initGerm=function(){this.addAvatars()},e.prototype.initEvent=function(){App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.removeEvent=function(){App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.__enterFrameHandler=function(t){this._gameFrame++,this.updateAvatar(),this.checkAllHit(),this.updateTime(),this.dispatchEventWith(MEvent.GAME_ENTER_FRAME)},e.prototype.checkAllHit=function(){this.checkTCellHit()},e.prototype.checkTCellHit=function(){MapUtils.checkHits(this._tcells,this._germs)},e.prototype.updateTime=function(){this._gameFrame%GameConst.GAME_FRAME==0&&(this._currTime++,this.updateGold(),this.dispatchEventWith(MEvent.HEARTBEAT),this.lastTime<=0?this.gameOver():this.addAvatars())},e.prototype.updateAvatar=function(){var t,e,i=this._tcells.length,r=!1;for(t=i-1;t>=0;t--)e=this._tcells[t],e.isDie?(r=!0,this._tcells.splice(t,1)):e.update(this._gameFrame);for(i=this._germs.length,t=i-1;t>=0;t--)e=this._germs[t],e.isDie?(r=!0,this._germs.splice(t,1)):e.update(this._gameFrame);for(i=this._antis.length,t=i-1;t>=0;t--)e=this._antis[t],e.isDie?(r=!0,this._antis.splice(t,1)):e.update(this._gameFrame);for(i=this._sgerms.length,t=i-1;t>=0;t--)e=this._sgerms[t],e.isDie?(r=!0,this._sgerms.splice(t,1)):e.update(this._gameFrame);r&&this.dispatchEventWith(MEvent.GERM_UPDATE)},e.prototype.updateGold=function(){var t=this.currGold,e=this._mapDesc.addGold,i=e;t+e>this._maxGold&&(i=this._maxGold-t),i>0&&(this._currGold+=i,this.dispatchEventWith(MEvent.ADD_GOLD))},e.prototype.addAvatars=function(){var t=!1,e=this._factory.getGramByTime(this._currTime);e&&e.length>0&&(t=!0,this.createAvatar(e));var i=this._factory.getCellByTime(this._currTime);i&&i.length>0&&(t=!0,this.createAvatar(i));var r=this._factory.getGrem(this._currTime);r&&(t=!0,this.createAvatar([r]));var o=this._factory.getCell(this._currTime);o&&(t=!0,this.createAvatar([o])),t&&this.dispatchEventWith(MEvent.GERM_UPDATE)},e.prototype.createAvatar=function(t){if(t&&0!=t.length)for(var e,i=t.length,r=0;i>r;r++)e=t[r],this.createAvatarByType(e)},e.prototype.createAvatarByType=function(t,e){void 0===e&&(e=!0);var i;if(t){switch(t.type){case 101:i=new WaterAvatar(t);break;case 201:i=new TCellAvatar(t);break;case 301:i=new Germ_1_Avatar(t);break;case 302:i=new Germ_2_Avatar(t);break;case 303:i=new Germ_3_Avatar(t);break;case 304:i=new Germ_4_Avatar(t);break;case 401:i=new AntiAvatar_1(t);break;case 402:i=new AntiAvatar_2(t);break;case 403:i=new AntiAvatar_3(t)}i&&e&&this.addAvatar(i)}return i},e.prototype.addAvatar=function(t){if(t){var e,i=t.type,r=Math.floor(i/100);e=2==r?this._tcells:5==r?this._sgerms:4==r?this._antis:this._germs,e.indexOf(t)>=0||e.push(t)}},e.prototype.addWater=function(){var t=new WaterEffect;t.addEventListener(egret.Event.COMPLETE,this.__waterComplete,this)},e.prototype.__waterComplete=function(t){var e=t.currentTarget;e&&e.removeEventListener(egret.Event.COMPLETE,this.__waterComplete,this);var i=this._mapDesc.germMinSafe||0,r=this.tcellCount,o=this.germCount,n=0,s=0;for(r>=15&&o>=15&&(n=i-Math.floor(3*Math.random()+1),s=i-Math.floor(3*Math.random()+1));this._tcells.length>n;)GameConst.dispose(this._tcells.pop());for(;this._germs.length>s;)GameConst.dispose(this._germs.pop());this.dispatchEventWith(MEvent.GERM_UPDATE)},Object.defineProperty(e.prototype,"gameFrame",{get:function(){return this._gameFrame},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"maxGold",{get:function(){return this._maxGold},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currGold",{get:function(){return this._currGold},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"lastTime",{get:function(){return this._totalTime-this._currTime},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tcellCount",{get:function(){return this._tcells.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"germCount",{get:function(){return this._germs.length},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sgermCount",{get:function(){return this._sgerms.length},enumerable:!0,configurable:!0}),e.prototype.pause=function(){3==this._stauts&&(this._stauts=2,this.removeEvent(),SwitchHelp.openPauseFrame())},e.prototype.resume=function(){this._setuped&&3!=this._stauts&&(this._stauts=3,this.initEvent())},e.prototype.restart=function(){this._setuped&&(this.init(),this.start(),this.dispatchEventWith(MEvent.RESTART))},e.prototype.gameOver=function(){this._setuped&&(this._stauts=4,this.removeEvent(),this.dispatchEventWith(MEvent.GAME_OVER))},e.prototype.destoryAvatar=function(){for(var t=this._tcells.concat(this._germs).concat(this._sgerms).concat(this._antis),e=t.length,i=0;e>i;i++)GameConst.dispose(t[i]);this._tcells.length=0,this._germs.length=0,this._sgerms.length=0,this._antis.length=0},e.prototype.create=function(t){var e,i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(t),i.grade=3,e=this.createAvatarByType(i,!1)},e.prototype.buyProp=function(t){this._currGold-=t,this.dispatchEventWith(MEvent.ADD_GOLD)},e.prototype.exit=function(){this.removeEvent(),this._setuped=!1,this._mapData=null,this._mapDesc=null,this._level=0,this._gameFrame=0,this._stauts=1,this.destoryAvatar(),this._factory.exit()},e}(egret.EventDispatcher);__reflect(GameManager.prototype,"GameManager");var LevelFactory_1=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,302,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[35]=this.__thirtyFiveTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell,this.cells[45]=this.__fortyFiveTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t=[],e=0;6>e;e++)t.push(this.getOneGerm());return t},t.prototype.__twentyTimeGerm=function(){for(var t=[],e=0;2>e;e++)t.push(this.getOneGerm());return t},t.prototype.__thirtyFiveTimeGerm=function(){for(var t=[],e=0;2>e;e++)t.push(this.getOneGerm());return t},t.prototype.__fortyFiveTimeGerm=function(){for(var t=[],e=0;1>e;e++)t.push(this.getOneGerm());return t},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;5>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;7>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;5>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(){var t={};return t.type=this.germPool[Math.floor(Math.random()*this.germPool.length)],t.speed=GameConst.getGermSpeedByType(t.type),t.grade=1,t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getGrem=function(t){return t==this.nextGerm?(this.nextGerm+=4,this.getOneGerm()):null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_1.prototype,"LevelFactory_1",["ILevelFactory"]);var LevelFactory_2=function(){function t(){this.count=10,this.init()}return t.prototype.init=function(){this.germPool=[301,302,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell,this.cells[45]=this.__fortyFiveTimeCell
},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;2>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t));for(var i=0;4>i;i++)t=303,e.push(this.getOneGerm(t,3));return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t));return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;7>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return this.count>0?(e=303,i=2+Math.floor(2*Math.random()),this.count--):(e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=1),this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_2.prototype,"LevelFactory_2",["ILevelFactory"]);var LevelFactory_3=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;2>i;i++)t=302,e.push(this.getOneGerm(t,3));for(var i=0;6>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;12>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__fortyFiveTimeGerm=function(){for(var t,e=[],i=0;12>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;5>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;9>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=3,this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_3.prototype,"LevelFactory_3",["ILevelFactory"]);var LevelFactory_4=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[10]=this.__tenTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__tenTimeGerm=function(){for(var t,e=[],i=0;3>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;1>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;7>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;3>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__fortyFiveTimeGerm=function(){for(var t,e=[],i=0;9>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;3>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;5>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;9>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=3,this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_4.prototype,"LevelFactory_4",["ILevelFactory"]);var LevelFactory_5=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,302,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[10]=this.__tenTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__tenTimeGerm=function(){for(var t,e=[],i=0;7>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;2>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__fortyFiveTimeGerm=function(){for(var t,e=[],i=0;11>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;5>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=3,this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_5.prototype,"LevelFactory_5",["ILevelFactory"]);var LevelFactory_6=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,302,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[10]=this.__tenTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[35]=this.__thirtyFiveTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__tenTimeGerm=function(){for(var t,e=[],i=0;7>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;2>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__thirtyFiveTimeGerm=function(){for(var t,e=[],i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;2>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__fortyFiveTimeGerm=function(){for(var t,e=[],i=0;9>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;6>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=3,this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_6.prototype,"LevelFactory_6",["ILevelFactory"]);var LevelFactory_7=function(){function t(){this.init()}return t.prototype.init=function(){this.germPool=[301,302,303,304],this.germs={},this.cells={},this.nextGerm=4,this.nextCell=2+Math.floor(2*Math.random()),this.germs[0]=this.__zeroTimeGerm,this.germs[10]=this.__tenTimeGerm,this.germs[20]=this.__twentyTimeGerm,this.germs[35]=this.__thirtyFiveTimeGerm,this.germs[45]=this.__fortyFiveTimeGerm,this.cells[0]=this.__zeroTimeCell,this.cells[10]=this.__tenTimeCell,this.cells[20]=this.__twentyTimeCell,this.cells[35]=this.__thirtyFiveTimeCell},t.prototype.__zeroTimeGerm=function(){for(var t,e=[],i=0;8>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));return e},t.prototype.__tenTimeGerm=function(){for(var t,e=[],i=0;5>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__twentyTimeGerm=function(){for(var t,e=[],i=0;6>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;6>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__thirtyFiveTimeGerm=function(){for(var t,e=[],i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;4>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__fortyFiveTimeGerm=function(){for(var t,e=[],i=0;9>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],e.push(this.getOneGerm(t,3));for(var r,i=0;6>i;i++)t=this.germPool[Math.floor(Math.random()*this.germPool.length)],r=this.getOneGerm(t,3),r.supper=!0,r.sgrade=1,e.push(r);return e},t.prototype.__zeroTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__tenTimeCell=function(){for(var t=[],e=0;12>e;e++)t.push(this.getOneTCell());return t},t.prototype.__twentyTimeCell=function(){for(var t=[],e=0;8>e;e++)t.push(this.getOneTCell());return t},t.prototype.__thirtyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.__fortyFiveTimeCell=function(){for(var t=[],e=0;10>e;e++)t.push(this.getOneTCell());return t},t.prototype.getOneTCell=function(){var t={};return t.type=201,t.grade=1,t.speed=GameConst.getGermSpeedByType(t.type),t.angel=Math.floor(360*Math.random()),t.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),t.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),t},t.prototype.getOneGerm=function(t,e){var i={};return i.type=t,i.speed=GameConst.getGermSpeedByType(i.type),i.grade=e||1,i.angel=Math.floor(360*Math.random()),i.x=Math.floor(Math.random()*LayerManager.STAGE_WIDTH),i.y=Math.floor(Math.random()*LayerManager.STAGE_HEIGHT),i},t.prototype.getGrem=function(t){if(t==this.nextGerm){this.nextGerm+=4;var e=void 0,i=void 0;return e=this.germPool[Math.floor(Math.random()*this.germPool.length)],i=3,this.getOneGerm(e,i)}return null},t.prototype.getCell=function(t){return t==this.nextCell?(this.nextCell+=2+Math.floor(2*Math.random()),this.getOneTCell()):null},t.prototype.getGramByTime=function(t){var e=this.germs[t];return e?e.call(this):null},t.prototype.getCellByTime=function(t){var e=this.cells[t];return e?e.call(this):null},t}();__reflect(LevelFactory_7.prototype,"LevelFactory_7",["ILevelFactory"]);var GridManager=function(){function t(){if(this.MAX_W=1920,this.MAX_H=1080,this.grid_w=40,this.grid_h=40,this._sp={},this._tp={},this._ps=[],t._instance)throw new Error("class is instance!!!");t._instance=this,this.init()}return Object.defineProperty(t,"instance",{get:function(){return this._instance||new t},enumerable:!0,configurable:!0}),t.prototype.init=function(){this.total_col=Math.floor(this.MAX_W/this.grid_w),this.total_row=Math.floor(this.MAX_H/this.grid_h),this.gridList=[],this.openList=[],this.closeList=[]},t.prototype.setup=function(t){this._gridData=t,this._gridGroup={};for(var e,i,r,o=0;o<this.total_row;o++){e=this.gridList[o]||[];for(var n=0;n<this.total_col;n++)i=o*this.total_col+n,r=e[n]||new GridNode,r.row=o,r.col=n,r.type=this._gridData?this._gridData[i]||0:255,e[n]=r,this.addGridByType(r.type,o,n);this.gridList[o]=e}},t.prototype.addGridByType=function(t,e,i){for(var r,o=4,n=0;o>n;n++)r=1<<n,(t&r)>0&&(!this._gridGroup[r]&&(this._gridGroup[r]=[]),this._gridGroup[r].push({x:i,y:e}))},t.prototype.__touchHandler=function(t){if(!this._f){for(var e=0;e<this._ps.length;e++)this._ps[e].parent.removeChild(this._ps[e]);this._ps.length=0}var i=t.target;if(this._f){this._f=!1,this._tp.x=Math.floor(i.x/40),this._tp.y=Math.floor(i.y/40);var r=this.findPath(this._sp,this._tp,1);if(r)for(var o=0;o<r.length;o++)this._ps.push(this.draws(r[o],2,65280,20))}else this._sp.x=Math.floor(i.x/40),this._sp.y=Math.floor(i.y/40),this._f=!0,this._ps.push(this.draws(this._sp,2,65280,20))},t.prototype.draws=function(t,e,i,r){var o=new egret.Shape;return o.graphics.beginFill(i,.4),1==e?o.graphics.drawRect(0,0,40,40):o.graphics.drawCircle(0,0,5),o.graphics.endFill(),o.x=40*t.x+r,o.y=40*t.y+r,App.layer.addChild(o,1),o},t.prototype.getGridByType=function(t){var e=this._gridGroup[t];if(e){var i=e.length;return e[Math.floor(Math.random()*i)]}return null},t.prototype.findPath=function(t,e,i){return t&&e?(this.resetGrid(),this.startNode=this.gridList[t.y][t.x],this.targetNode=this.gridList[e.y][e.x],this.startNode.target=this.targetNode,this.openList.push(this.startNode),this.checkOpenList(i),this.targetNode.parent||console.log("未找到路径!!!"),this.getTargetPath()):null},t.prototype.resetGrid=function(){this.closeList.length=0,this.openList.length=0;for(var t,e,i=0;i<this.total_row;i++){t=this.gridList[i]||[];for(var r=0;r<this.total_col;r++)e=t[r],e&&e.reset()}},t.prototype.getTargetPath=function(){for(var t=[],e=this.targetNode;e.parent;)t.unshift({x:e.col,y:e.row}),e=e.parent;return t},t.prototype.checkOpenList=function(t){if(!(0==this.openList.length||this.openList.indexOf(this.targetNode)>=0)){var e=this.openList.shift(),i=this.getNode(e.row-1,e.col-1);this.checkGridNode(e,i,t),i=this.getNode(e.row-1,e.col),this.checkGridNode(e,i,t),i=this.getNode(e.row-1,e.col+1),this.checkGridNode(e,i,t),i=this.getNode(e.row,e.col+1),this.checkGridNode(e,i,t),i=this.getNode(e.row+1,e.col+1),this.checkGridNode(e,i,t),i=this.getNode(e.row+1,e.col),this.checkGridNode(e,i,t),i=this.getNode(e.row+1,e.col-1),this.checkGridNode(e,i,t),i=this.getNode(e.row,e.col-1),this.checkGridNode(e,i,t),this.closeList.push(e),this.openList.sort(this.compareFunction),this.checkOpenList(t)}},t.prototype.checkGridNode=function(t,e,i){if(e&&!(this.closeList.indexOf(e)>=0)){if(!e.parent)return void(e.type&i?(e.parent=t,this.openList.push(e)):this.closeList.push(e));var r=e.fval,o=e.parent.fval+this.computeCost(t,e);r>o&&(e.parent=t)}},t.prototype.compareFunction=function(t,e){return t.fval<=e.fval?-1:1},t.prototype.getNode=function(t,e){return 0>t||t>=this.total_row?null:0>e||e>=this.total_col?null:this.gridList[t][e]},t.prototype.computeCost=function(t,e){return t&&e?t.col!=e.col&&t.row!=e.row?14:10:0},t}();__reflect(GridManager.prototype,"GridManager");var GridNode=function(){function t(){this._gval=0,this._hval=0}return Object.defineProperty(t.prototype,"index",{get:function(){return this.row*App.grid.total_col+this.col},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){t&&(this._parent=t,this.updateHval())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"target",{set:function(t){t&&(this._target=t,this.updateGval())},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hval",{get:function(){return this._hval},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"gval",{get:function(){return this._gval},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fval",{get:function(){return this._hval+this._gval},enumerable:!0,configurable:!0}),t.prototype.updateHval=function(){this._hval=this._parent.hval+App.grid.computeCost(this._parent,this)},t.prototype.updateGval=function(){this._gval=Math.abs(this.col-this._target.col)+Math.abs(this.row-this._target.row)},t.prototype.reset=function(){this._parent=null,this._target=null,this._hval=0,this._gval=0},t}();__reflect(GridNode.prototype,"GridNode");var HpBar=function(t){function e(e){var i=t.call(this)||this;return i.left=0,i.top=0,i._mapDesc=e||{},i}return __extends(e,t),e.prototype.initView=function(){this.touchEnabled=this.touchChildren=!1,this._total=this._mapDesc.germTotal||0,this._min=this._mapDesc.germMinSafe||0,this._max=this._mapDesc.germMaxSafe||0,this._qua=this._mapDesc.qua||[];var t=Math.floor(this._min/this._total*419),e=Math.floor(this._max/this._total*419);this.tcellRect.x=this.germRect.x=t,this.tcellRect.width=this.germRect.width=e-t,this.warningImg_1.visible=this.warningImg_2.visible=!1,this._errorImg=new eui.Image,this._errorImg.source=ResConst.json_hp+".hp_error",this._errorImg.touchEnabled=!1,this._errorImg.scale9Grid=new egret.Rectangle(74,78,129,95),this._errorImg.width=1920,this._errorImg.height=1080,this._errorImg.visible=!1,App.layer.addChild(this._errorImg,3)},e.prototype.initEvent=function(){App.game.addEventListener(MEvent.GERM_UPDATE,this.__germUpdateHandler,this),App.game.addEventListener(MEvent.GAME_OVER,this.__gameOverHandler,this)},e.prototype.removeEvent=function(){App.game.removeEventListener(MEvent.GERM_UPDATE,this.__germUpdateHandler,this),App.game.removeEventListener(MEvent.GAME_OVER,this.__gameOverHandler,this),App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.initData=function(){},e.prototype.__germUpdateHandler=function(t){this.updateGermProg(),this.updateCellProg(),this.updateState(),this.playError()},e.prototype.updateCellProg=function(){var t=App.game.tcellCount;this.tcellTxt.text=t.toString();var e=this.tcellGroup.scrollRect||new egret.Rectangle(0,0,0,30);e.width=Math.min(419,Math.floor(t/this._total*419)),this.tcellGroup.scrollRect=e,t<this._min||t>this._max?this.warningImg_1.visible=!0:this.warningImg_1.visible=!1},e.prototype.updateGermProg=function(){var t=App.game.sgermCount,e=App.game.germCount,i=t+e;this.germTxt.text=i.toString();var r=this.germGroup.scrollRect||new egret.Rectangle(0,0,0,30);r.width=Math.min(419,Math.floor(i/this._total*419)),this.germGroup.scrollRect=r,i<this._min||i>this._max?this.warningImg_2.visible=!0:this.warningImg_2.visible=!1},e.prototype.updateState=function(){var t=parseInt(this.germTxt.text),e=parseInt(this.tcellTxt.text);return t>this._total||e>this._total?void App.game.gameOver():void 0},e.prototype.__gameOverHandler=function(t){var e,i=App.game.sgermCount,r=App.game.germCount,o=App.game.tcellCount,n=0,s=0;if(i>0)e=4;else if(r>this._total)e=2;else if(o>this._total)e=3;else if(r<this._min||r>this._max||o<this._min||o>this._max)n=r-o,e=n>0?2:3;else{e=1,n=Math.abs(r-o);for(var a=this._qua.length,h=void 0,p=0;a>p;p++)if(h=this._qua[p],n>=h[0]&&n<=h[1]){s=p+1;break}App.player.updateLevelStar(App.scene.level,s)}SwitchHelp.openResultFrame(e,s),SwitchHelp.checkUnlockProp(s,this._mapDesc.unlock),this._errorImg.visible=!1,App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.playError=function(){var t=this.warningImg_1.visible||this.warningImg_2.visible;t?this._startTime||(this._startTime=egret.getTimer(),App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)):(this._startTime=0,this._errorImg.visible=!1,App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this))},e.prototype.__enterFrameHandler=function(t){if(this._startTime){var e=egret.getTimer(),i=Math.floor((e-this._startTime)/200);this._errorImg.visible=i%2==0}},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),RES.destroyRes(ResConst.json_hp),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(HpBar.prototype,"HpBar");var PauseFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){},e.prototype.initEvent=function(){this.replayBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__replayBtnHandler,this),this.startBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__startBtnHandler,this),this.menuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__menuBtnHandler,this)},e.prototype.removeEvent=function(){this.replayBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__replayBtnHandler,this),this.startBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__startBtnHandler,this),this.menuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__menuBtnHandler,this)},e.prototype.initData=function(){},e.prototype.__replayBtnHandler=function(t){GameConst.dispose(this),App.game.restart()},e.prototype.__startBtnHandler=function(t){GameConst.dispose(this),App.game.resume()},e.prototype.__menuBtnHandler=function(t){GameConst.dispose(this),App.scene.exitScene()},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),RES.destroyRes(ResConst.json_pause),GameConst.dispose(this.replayBtn),this.replayBtn=null,GameConst.dispose(this.startBtn),this.startBtn=null,GameConst.dispose(this.menuBtn),this.menuBtn=null,t.prototype.dispose.call(this)},e}(BaseUI);__reflect(PauseFrame.prototype,"PauseFrame");var PriceBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.left=20,this.bottom=10,this.touchEnabled=this.touchChildren=!1},e.prototype.initEvent=function(){App.game.addEventListener(MEvent.ADD_GOLD,this.__goldUpdateHandler,this),App.game.addEventListener(MEvent.RESTART,this.__goldUpdateHandler,this)},e.prototype.removeEvent=function(){App.game.removeEventListener(MEvent.ADD_GOLD,this.__goldUpdateHandler,this),App.game.removeEventListener(MEvent.RESTART,this.__goldUpdateHandler,this)},e.prototype.initData=function(){this.__goldUpdateHandler()},e.prototype.__goldUpdateHandler=function(){this.currPrice=App.game.currGold,this.maxPrice=App.game.maxGold,this.priceTxt.text="$ "+this.currPrice+"x"+this.maxPrice},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),GameConst.dispose(this.priceTxt),this.priceTxt=null,t.prototype.dispose.call(this)},e}(BaseUI);__reflect(PriceBar.prototype,"PriceBar");var ResultBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){},e.prototype.initEvent=function(){this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__backBtnHandler,this),this.menuBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__menuBtnHandler,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextBtnHandler,this)},e.prototype.removeEvent=function(){this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__backBtnHandler,this),this.menuBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__menuBtnHandler,this),this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextBtnHandler,this)},e.prototype.initData=function(){this.updateView()},e.prototype.updateView=function(){if(this._isFinish&&this.resStatus)if(1==this.resStatus){this.result_tip_img.source="res_succ_tips_png",this.result_img.source="result_json.res_succ_title",this.starGroup.visible=!0,this.result_desc_img.source="succ_1_png",this.result_desc_img.verticalCenter=160;for(var t=this.star,e=void 0,i=1;t>=i;i++)e=this["star_"+i],e&&(e.source="result_json.res_star_d")}else{if(this.result_tip_img.source="res_fail_tips_png",this.result_img.source="result_json.res_fail_title",this.starGroup.visible=!1,4==this.resStatus)this.result_desc_img.source="succ_1_png";else{var r=App.scene.level;this.result_desc_img.source="fail_"+this.resStatus+"_"+r+"_png"}this.result_desc_img.verticalCenter=20}},e.prototype.__backBtnHandler=function(t){App.game.restart(),GameConst.dispose(this)},e.prototype.__menuBtnHandler=function(t){App.scene.exitScene()},e.prototype.__nextBtnHandler=function(t){App.scene.exitScene()},e.prototype.show=function(t,e){this.resStatus=t,this.star=e,this.updateView(),App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),GameConst.dispose(this.result_img),this.result_img=null,GameConst.dispose(this.result_desc_img),this.result_desc_img=null,GameConst.dispose(this.result_tip_img),this.result_tip_img=null,GameConst.dispose(this.star_1),this.star_1=null,GameConst.dispose(this.star_2),this.star_2=null,GameConst.dispose(this.star_3),this.star_3=null,GameConst.dispose(this.starGroup),this.starGroup=null,GameConst.dispose(this.backBtn),this.backBtn=null,GameConst.dispose(this.menuBtn),this.menuBtn=null,GameConst.dispose(this.nextBtn),this.nextBtn=null,GameConst.dispose(this.btnGroup),this.btnGroup=null,t.prototype.dispose.call(this)},e}(BaseUI);__reflect(ResultBar.prototype,"ResultBar");var TimeBar=function(t){function e(){return t.call(this)||this
}return __extends(e,t),e.prototype.initView=function(){this.right=20,this.bottom=10,this.touchEnabled=!1,this.currTime=0,this.timeTxt.text="00 p 00"},e.prototype.initEvent=function(){this.pauseBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__pauseBtnHandler,this),App.game.addEventListener(MEvent.HEARTBEAT,this.__heartbeatHandler,this),App.game.addEventListener(MEvent.RESTART,this.__heartbeatHandler,this)},e.prototype.removeEvent=function(){this.pauseBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__pauseBtnHandler,this),App.game.removeEventListener(MEvent.HEARTBEAT,this.__heartbeatHandler,this),App.game.removeEventListener(MEvent.RESTART,this.__heartbeatHandler,this)},e.prototype.initData=function(){this.__heartbeatHandler()},e.prototype.__heartbeatHandler=function(){this.currTime=App.game.lastTime,this.updateTime()},e.prototype.updateTime=function(){var t=this.formatValue(Math.floor(this.currTime/60)),e=this.formatValue(this.currTime%60);this.timeTxt.text=t+"p"+e},e.prototype.formatValue=function(t){return 10>t?"0"+t:t+""},e.prototype.__pauseBtnHandler=function(t){App.game.pause()},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),RES.destroyRes(ResConst.json_pause),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(TimeBar.prototype,"TimeBar");var ToolBar=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.top=0,this.right=0,this.touchChildren=!0,this.touchEnabled=!1,this.allBtns={},this.allBtns[101]=this.btn_101,this.allBtns[301]=this.btn_301,this.allBtns[201]=this.btn_201,this.allBtns[401]=this.btn_401,this.allBtns[403]=this.btn_403,this.allBtns[402]=this.btn_402,this.allBtns[302]=this.btn_302,this.allBtns[303]=this.btn_303,this.allBtns[304]=this.btn_304},e.prototype.initEvent=function(){},e.prototype.removeEvent=function(){},e.prototype.initData=function(){this.updateView()},e.prototype.updateView=function(){var t=App.scene.mapDesc;if(t){var e,i=t.proplib||[];for(var r in this.allBtns)e=this.allBtns[r],e&&i.indexOf(parseInt(r))>=0?(e.$autoSelected=!1,e.visible=!0):e.visible=!1,e.selected=App.player.haveGoods(parseInt(r))}},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){this.removeEvent(),RES.destroyRes(ResConst.json_toolbar),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(ToolBar.prototype,"ToolBar");var NewPorpFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.backImg_1.source="np_b_1_png",this.backImg_2.source="np_b_2_png"},e.prototype.initEvent=function(){App.stage.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__stageClickHandler,this)},e.prototype.removeEvent=function(){App.stage.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__stageClickHandler,this),App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.initData=function(){this.updateView()},e.prototype.updateView=function(){this._isFinish&&this.propId&&(this.tipImg.source="np_"+this.propId+"_png",this.step=0,App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this))},e.prototype.__enterFrameHandler=function(t){this.step++,this.step%5==0&&(this.step/5%2==0?(this.addChildAt(this.backImg_1,1),this.backImg_2.parent&&this.backImg_2.parent.removeChild(this.backImg_2)):(this.addChildAt(this.backImg_2,1),this.backImg_1.parent&&this.backImg_1.parent.removeChild(this.backImg_1)))},e.prototype.__stageClickHandler=function(t){GameConst.dispose(this)},e.prototype.show=function(t){this.propId=t,this.updateView(),App.layer.addChild(this,3)},e.prototype.dispose=function(){this.removeEvent(),this.backImg_1&&(GameConst.dispose(this.backImg_1),RES.destroyRes(this.backImg_1.source)),this.backImg_1=null,this.backImg_2&&(GameConst.dispose(this.backImg_2),RES.destroyRes(this.backImg_2.source)),this.backImg_2=null,this.tipImg&&(GameConst.dispose(this.tipImg),RES.destroyRes(this.tipImg.source)),this.tipImg=null,t.prototype.dispose.call(this)},e}(BaseUI);__reflect(NewPorpFrame.prototype,"NewPorpFrame");var PlateFrame=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){this.width=1920,this.height=1080,this.verticalCenter=0,this.horizontalCenter=0,this.touchEnabled=!1,this.touchChildren=!1,this._img=new eui.Image,this._img.verticalCenter=0,this._img.horizontalCenter=0,this.addChild(this._img)},e.prototype.removeEvent=function(){App.stage.stage.removeEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)},e.prototype.show=function(t){this._imgArr=t,this._total=this._imgArr?this._imgArr.length:0,this._total>0?(App.layer.addChild(this,2),this._index=0,this._step=-1,App.stage.stage.addEventListener(egret.Event.ENTER_FRAME,this.__enterFrameHandler,this)):GameConst.dispose(this)},e.prototype.__enterFrameHandler=function(t){if(this._step++,this._step%4==0){if(this._index>=this._total)return void GameConst.dispose(this);this._img.texture=this._imgArr[this._index],this._index++}},e.prototype.dispose=function(){this.removeEvent(),GameConst.dispose(this._img),this._img=null,this._imgArr&&(this._imgArr.length=0),this._imgArr=null,this.parent&&this.parent.removeChild(this),this.dispatchEventWith(egret.Event.CLOSE)},e}(eui.Group);__reflect(PlateFrame.prototype,"PlateFrame",["IDispose"]);var ShopFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.verticalCenter=0,this.horizontalCenter=0,this.itemData=new eui.ArrayCollection,this.itemGroup.dataProvider=this.itemData,this.itemGroup.itemRenderer=ShopItem},e.prototype.initEvent=function(){this.backBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__backBtnHandler,this)},e.prototype.removeEvent=function(){this.backBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__backBtnHandler,this)},e.prototype.initData=function(){for(var t=App.config.getAllShopGoods(),e=t.length,i=0;e>i;i++)this.itemData.source.push(t[i]);this.itemData.refresh()},e.prototype.__backBtnHandler=function(t){SwitchHelp.openLevelFrame(),GameConst.dispose(this)},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){if(this.removeEvent(),GameConst.dispose(this.backBtn),this.backBtn=null,this.scroller&&(this.scroller.stopAnimation(),this.scroller.viewport=null,GameConst.dispose(this.scroller)),this.scroller=null,this.itemGroup&&(this.itemGroup.dataProvider=null,GameConst.dispose(this.itemGroup)),this.itemGroup=null,RES.destroyRes(ResConst.json_shop),this.itemData)for(var e=this.itemData.length,i=void 0,r=0;e>r;r++)i=this.itemData.getItemAt(r),i&&RES.destroyRes(GameConst.getGoodsBackPath(i.type));this.itemData=null,t.prototype.dispose.call(this)},e}(BaseUI);__reflect(ShopFrame.prototype,"ShopFrame");var ShopItem=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){},e.prototype.initEvent=function(){this.addEventListener(egret.Event.REMOVED_FROM_STAGE,this.__removeStageHandler,this),this.lockBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__lockBtnHandler,this)},e.prototype.removeEvent=function(){this.removeEventListener(egret.Event.REMOVED_FROM_STAGE,this.__removeStageHandler,this),this.lockBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__lockBtnHandler,this)},e.prototype.initData=function(){this.dataChanged()},e.prototype.dataChanged=function(){this.isFinish&&this.data&&(this.info=this.data,this.info&&(this.currUrl=GameConst.getGoodsBackPath(this.info.type),RES.getResByUrl(this.currUrl,this.__backCompleteHandler,this),this.updateState()))},e.prototype.updateState=function(){var t=App.player.haveGoods(this.info.type);this.lockGroup.visible=!t,t||(this.countTxt.text=(this.info.needStar||0)+"")},e.prototype.__backCompleteHandler=function(t,e){t&&this.currUrl==e&&(this.goodsImg.texture=t)},e.prototype.__lockBtnHandler=function(t){var e=this.info.needStar,i=App.player.totalStar;return e>i?void App.msg.show(e+"星可解锁"):void 0},e.prototype.__removeStageHandler=function(t){GameConst.dispose(this)},e.prototype.dispose=function(){this.removeEvent(),t.prototype.dispose.call(this)},e}(BaseRenderer);__reflect(ShopItem.prototype,"ShopItem");var TeachFrame=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.initView=function(){this.urlList=[]},e.prototype.initEvent=function(){this.preBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__preBtnHandler,this),this.nextBtn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextBtnHandler,this)},e.prototype.removeEvent=function(){this.preBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__preBtnHandler,this),this.nextBtn.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.__nextBtnHandler,this)},e.prototype.initData=function(){this.currPage=1,this.updateView()},e.prototype.updateView=function(){this.currUrl=GameConst.getTeachPath(this.currPage),-1==this.urlList.indexOf(this.currUrl)&&this.urlList.push(this.currUrl),RES.getResByUrl(this.currUrl,this.__backCompleteHandler,this)},e.prototype.__backCompleteHandler=function(t,e){t&&this.currUrl==e&&(this.backImg.texture=t)},e.prototype.__preBtnHandler=function(t){this.currPage<=1||(this.currPage--,this.updateView())},e.prototype.__nextBtnHandler=function(t){return this.currPage>=9?void GameConst.dispose(this):(this.currPage++,void this.updateView())},e.prototype.show=function(){App.layer.addChild(this,2)},e.prototype.dispose=function(){if(this.removeEvent(),GameConst.dispose(this.preBtn),this.preBtn=null,GameConst.dispose(this.nextBtn),this.nextBtn=null,GameConst.dispose(this.backImg),this.backImg=null,this.urlList)for(;this.urlList.length>0;)RES.destroyRes(this.urlList.pop());this.urlList=null,RES.destroyRes(ResConst.json_shop),t.prototype.dispose.call(this)},e}(BaseUI);__reflect(TeachFrame.prototype,"TeachFrame");var SwitchHelp;!function(t){function e(t){(new LevelFrame).show(t)}function i(){(new LoginFrame).show()}function r(){(new ShopFrame).show()}function o(){(new PauseFrame).show()}function n(t,e){(new ResultBar).show(t,e)}function s(t){setTimeout(function(){(new NewPorpFrame).show(t)},50)}function a(t,e){if(t>0){if(e=e||0,!e)for(var i=App.config.getAllShopGoods(),r=App.player.totalStar,o=i?i.length:0,n=void 0,s=0;o>s;s++)if(n=i[s],!App.player.haveGoods(n.type)&&r>=n.needStar){e=n.type;break}App.player.addPorp(e)}}t.openLevelFrame=e,t.openLoginFrame=i,t.openShopFrame=r,t.openPauseFrame=o,t.openResultFrame=n,t.openNewPropFrame=s,t.checkUnlockProp=a}(SwitchHelp||(SwitchHelp={}));